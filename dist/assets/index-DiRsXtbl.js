(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const V=e=>{e.remove()},x=(e,t,{onPreviewPicture:o,onLikeIcon:n,onDeleteCard:r})=>{const s=document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),a=s.querySelector(".card__like-button");s.querySelector(".card__like-button_is-active");const E=s.querySelector(".card__control-button_type_delete"),h=s.querySelector(".card__image"),B=s.querySelector(".card__like-count");return h.src=e.link,h.alt=e.name,s.querySelector(".card__title").textContent=e.name,B.textContent=e.likes.length,e.likes.some(D=>D._id===t)&&a.classList.add("card__like-button_is-active"),n&&a.addEventListener("click",()=>{n(a,B,e._id)}),e.owner._id!==t?E.remove():r&&E.addEventListener("click",()=>{r(e._id,s)}),o&&h.addEventListener("click",()=>o({name:e.name,link:e.link})),s},$=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",$)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",$)},W=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&l(e)})},j=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)},A=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},J=(e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?A(e,t,o):j(e,t,t.validationMessage,o)},H=e=>e.some(t=>!t.validity.valid),U=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},z=(e,t)=>{e.disabled=!1,e.classList.remove(t.inactiveButtonClass)},I=(e,t,o)=>{H(e)?U(t,o):z(t,o)},K=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);I(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{J(e,r,t),I(o,n,t)})})},R=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{K(o,e)})},v=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{A(e,r,t),r.setCustomValidity("")}),U(n,t)},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"29ae178e-d4e8-485a-9112-44008e04f970","Content-Type":"application/json"}},i=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),G=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(i),Q=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(i),X=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(i),Y=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(i),Z=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(i),ee=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(i),te=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(i),y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},F=document.querySelector(".places__list"),S=document.querySelector(".popup_type_edit"),p=S.querySelector(".popup__form"),w=p.querySelector(".popup__input_type_name"),M=p.querySelector(".popup__input_type_description"),b=document.querySelector(".popup_type_new-card"),u=b.querySelector(".popup__form"),oe=u.querySelector(".popup__input_type_card-name"),re=u.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_image"),P=L.querySelector(".popup__image"),ne=L.querySelector(".popup__caption"),se=document.querySelector(".profile__edit-button"),ce=document.querySelector(".profile__add-button"),C=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),d=k.querySelector(".popup__form"),ae=d.querySelector(".popup__input");let f=null;const _=(e,t)=>{t.textContent=e?"Сохранение...":"Сохранить"},O=({name:e,link:t})=>{P.src=t,P.alt=e,ne.textContent=e,m(L)},T=(e,t,o)=>{const n=e.classList.contains("card__like-button_is-active");te(o,n).then(r=>{e.classList.toggle("card__like-button_is-active"),t.textContent=r.likes.length}).catch(r=>console.log(r))},N=(e,t)=>{ee(e).then(()=>{V(t)}).catch(o=>console.log(o))},ie=e=>{e.preventDefault();const t=p.querySelector(".popup__button");_(!0,t),X({name:w.value,about:M.value}).then(o=>{C.textContent=o.name,q.textContent=o.about,l(S)}).catch(o=>{console.log(o)}).finally(()=>{_(!1,t)})},le=e=>{e.preventDefault();const t=d.querySelector(".popup__button");_(!0,t),Y(ae.value).then(o=>{g.style.backgroundImage=`url(${o.avatar})`,l(k)}).catch(o=>{console.log(o)}).finally(()=>{_(!1,t)})},ue=e=>{e.preventDefault();const t=u.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",Z({name:oe.value,link:re.value}).then(n=>{F.prepend(x(n,f,{onPreviewPicture:O,onLikeIcon:T,onDeleteCard:N})),l(b)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})};p.addEventListener("submit",ie);u.addEventListener("submit",ue);d.addEventListener("submit",le);se.addEventListener("click",()=>{w.value=C.textContent,M.value=q.textContent,v(p,y),m(S)});g.addEventListener("click",()=>{d.reset(),v(d,y),m(k)});ce.addEventListener("click",()=>{u.reset(),v(u,y),m(b)});const de=document.querySelectorAll(".popup");de.forEach(e=>{W(e)});R(y);Promise.all([G(),Q()]).then(([e,t])=>{f=e._id,C.textContent=e.name,q.textContent=e.about,g.style.backgroundImage=`url(${e.avatar})`,t.forEach(o=>{F.append(x(o,f,{onPreviewPicture:O,onLikeIcon:T,onDeleteCard:N}))})}).catch(e=>{console.log(e)});
